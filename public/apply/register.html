<!DOCTYPE HTML>
<html>
<head>
    <title>팅팅팅</title>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,minimum-scale=1,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no">

    <meta id="meta_og_image" property="og:image" content="web/images/og_image_20230505.png">
    <meta id="meta_og_title" property="og:title" content="팅팅팅 소개팅 프로필 작성하러가기">
    <meta name="google" content="notranslate">

    <!-- css -->
    <link href="/apply/web/css/reset.css" rel="stylesheet" type="text/css">
    <link href="/apply/web/css/layout.css" rel="stylesheet" type="text/css">
    <link href="/apply/web/css/style.css" rel="stylesheet" type="text/css">

    <!-- js -->
    <script src="/apply/web/js/jquery-3.4.1.js"></script>
    <script src="/apply/web/js/noUiSlider.js"></script>
    
<script>
    // charmList와 faceList를 API에서 로드
    let charmList = [];
    let faceList = [];
    // isSave는 script.js에서 선언됨
    
    // charm 리스트 로드
    function loadCharmList() {
        $.ajax({
            url: '/api/apply/charm-list',
            type: 'GET',
            success: function(res) {
                if (res.success && res.data) {
                    charmList = res.data;
                    // 성격 선택 팝업에 동적으로 추가
                    updateCharmList();
                }
            },
            error: function() {
                console.error('Failed to load charm list');
            }
        });
    }
    
    // face 리스트 로드
    function loadFaceList() {
        $.ajax({
            url: '/api/apply/face-list',
            type: 'GET',
            success: function(res) {
                if (res.success && res.data) {
                    faceList = res.data;
                }
            },
            error: function() {
                console.error('Failed to load face list');
            }
        });
    }
    
    // 성격 리스트 업데이트
    function updateCharmList() {
        const $personalityList = $('#personality .arrayList');
        if ($personalityList.length && charmList.length) {
            $personalityList.empty();
            charmList.forEach(function(item) {
                $personalityList.append(
                    '<li><input type="checkbox" name="charm[]" id="charm' + item.seq + '" value="' + item.seq + '">' + item.key_word + '</li>'
                );
            });
        }
    }
</script>
<script src="/apply/web/js/script.js"></script>
</head>
<body>
    <form id="reg_form" method="post" enctype="multipart/form-data">
  
	<!-- page name : agreePage -->
    <div id="agreePageContent"></div>
    <div id="profilePageContent"></div>
    <div id="photoPageContent"></div>
    <div id="conditionPageContent"></div>
    <div id="photoManPageContent"></div>
    <div id="photoWomanPageContent"></div>
    <div id="idGuidePageContent"></div>

    <div class="popup" id="alertValidation">
        <p class="txt mt15 mb15"></p>
        <hr>
        <button type="button" class="btn lg bg-ff7b99 mt15" onclick="popClose('alertValidation');">확&nbsp;인</button>
    </div>
    </form>
    
    <script>
    // HTML 파일들을 직접 포함
    $(document).ready(function() {
        // 각 페이지를 순차적으로 로드
        $.when(
            $.get('/apply/agree.html'),
            $.get('/apply/profile.html'),
            $.get('/apply/photo.html'),
            $.get('/apply/condition.html'),
            $.get('/apply/photo_man.html'),
            $.get('/apply/photo_woman.html'),
            $.get('/apply/id_guide.html'),
            $.get('/apply/area-popups.html')
        ).done(function(agreeRes, profileRes, photoRes, conditionRes, photoManRes, photoWomanRes, idGuideRes, areaPopupsRes) {
            // HTML 삽입
            $('#agreePageContent').html(agreeRes[0]);
            $('#profilePageContent').html(profileRes[0]);
            $('#photoPageContent').html(photoRes[0]);
            $('#conditionPageContent').html(conditionRes[0]);
            $('#photoManPageContent').html(photoManRes[0]);
            $('#photoWomanPageContent').html(photoWomanRes[0]);
            $('#idGuidePageContent').html(idGuideRes[0]);
            $('body').append(areaPopupsRes[0]); // 지역 팝업은 body에 추가
            
            // agree.html 내부의 약관 내용 로드 스크립트 실행
            $('#termAgreeContent').load('/apply/check1.html');
            $('#privacyAgreeContent').load('/apply/check2.html');
            $('#marketingAgreeContent').load('/apply/check3.html');
            
            // 리스트 로드
            loadCharmList();
            loadFaceList();
            
            // HTML 로드 완료 후 script.js 초기화 코드 실행
            setTimeout(function() {
                // script.js의 초기화 로직 실행 (script.js가 로드된 후)
                if (typeof $ !== 'undefined') {
                    $('.m_view_data').hide();
                    $('.f_view_data').hide();
                    
                    $('#profilePage').hide();
                    $('#photoPage').hide();
                    $('#conditionPage').hide();
                    $('#M_photoGuidePage').hide();
                    $('#F_photoGuidePage').hide();
                    $('#idGuidePage').hide();
                    
                    // 첫 페이지 표시
                    if (!window.location.href.includes('#')) {
                        window.location.hash = 'agreePage';
                    } else {
                        const hash = window.location.href.split('#')[1];
                        if (hash && typeof changePage === 'function') {
                            changePage(hash);
                        } else {
                            $('#agreePage').show();
                        }
                    }
                    
                    // 동적으로 로드된 요소에 대한 이벤트 위임 설정
                    $(document).on('click', '.agree-arrow', function() {
                        var $item = $(this).closest('.agree-item');
                        var onclickAttr = $(this).attr('onclick');
                        if (onclickAttr) {
                            // onclick 속성에서 팝업 ID 추출
                            var match = onclickAttr.match(/popOpenAndDim\('([^']+)'/);
                            if (match && match[1]) {
                                if (typeof popOpenAndDim === 'function') {
                                    popOpenAndDim(match[1], true);
                                } else {
                                    console.error('popOpenAndDim function not found');
                                }
                            }
                        }
                    });
                    
                    // input-wrap 클릭 이벤트 위임
                    $(document).on('click', '.input-wrap.text', function() {
                        var onclickAttr = $(this).attr('onclick');
                        if (onclickAttr) {
                            var match = onclickAttr.match(/popOpenAndDim\('([^']+)'/);
                            if (match && match[1]) {
                                if (typeof popOpenAndDim === 'function') {
                                    popOpenAndDim(match[1], true);
                                }
                            }
                        }
                    });
                    
                    // history 및 이벤트 핸들러 설정
                    history.pushState(null, null, location.href); 
                    window.onpopstate = function(event) {
                        if (!window.location.href.includes('#')) {
                            if (confirm('작성중인 내용을 취소하고 나가시겠습니까?')) {
                                window.location.replace('about:blank').close();
                            } else {
                                location.hash = "agreePage";
                            }
                        }
                    };

                    window.onhashchange = (e) => {
                        if ($('.popup.on').length > 0) {
                            const oldHash = e.oldURL.split('#')[1];
                            location.hash = oldHash;
                        }
                        if (window.location.href.includes('#')) {
                            const hash = window.location.href.split('#')[1];
                            if (typeof changePage === 'function') {
                                changePage(hash);
                            }
                        }
                    };

                    window.onbeforeunload = (e) => {
                        if (typeof isSave !== 'undefined' && !isSave) {
                            e.preventDefault();
                            return '작성중인 내용을 취소하고 나가시겠습니까?';
                        }
                    };
                }
            }, 300);
        }).fail(function(xhr, status, error) {
            console.error('Failed to load HTML files:', error, xhr);
            alert('페이지를 불러오는 중 오류가 발생했습니다. 콘솔을 확인해주세요.');
        });
    });
    </script>
</body>
</html>

